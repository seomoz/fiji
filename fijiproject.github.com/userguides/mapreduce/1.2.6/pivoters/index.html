
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Pivoters</title>
    <meta name="description" content="Pivoters.">
    <meta name="author" content="WibiData">
    <link href="/assets/themes/twitter/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="/assets/themes/twitter/css/style.css" rel="stylesheet" type="text/css" media="all">
    <link href="/assets/themes/twitter/css/github.css" rel="stylesheet" type="text/css" media="all">
    <script src="http://code.jquery.com/jquery-latest.js" type="text/javascript"></script>
    <script src="/assets/themes/twitter/vallenato/vallenato.js" type="text/javascript"></script>
    <link rel="stylesheet" href="/assets/themes/twitter/css/vallenato.css" type="text/css" media="screen">
  </head>

  <body>
    <div class="navbar navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container-fluid">
          <a class="brand" href="http://www.fiji.org">Fiji Community</a>
          <ul class="nav">
            <li class="dropdown">
              <a href="http://www.fiji.org">The Fiji Project</a>
              <ul class="dropdown-menu">
                <li class="menu-item">
                  <a href="http://www.fiji.org/features">Features</a>
                </li>
              </ul>
            </li>
            <li>
              <a href="http://www.fiji.org/architecture">Architecture</a>
            </li>
            <li class="dropdown">
              <a href="http://www.fiji.org/getstarted/">Get Started</a>
              <ul class="dropdown-menu">
                <li class="menu-item">
                  <a href="http://www.fiji.org/getstarted/#Downloads">Downloads</a>
                </li>
                <li class="menu-item">
                  <a href="http://www.fiji.org/getstarted/#Installation">Installation</a>
                </li>
                <li class="menu-item">
                  <a href="http://www.fiji.org/getstarted/#Quick_Start_Guide">Quick Start Guide</a>
                </li>
                <li class="menu-item">
                  <a href="http://www.fiji.org/get-started-with-maven">Getting Started with Maven</a>
                </li>
                <li class="menu-item">
                  <a href="http://www.fiji.org/getstarted/#Training_Services">
                    Training & Services
                  </a>
                </li>
              </ul>
            </li>
            <li class="dropdown">
              <a href="http://www.fiji.org/getinvolved">Get Involved</a>
              <ul class="dropdown-menu">
                <li class="menu-item">
                  <a href="http://www.fiji.org/getinvolved/#Mailing_Lists">Mailing Lists</a>
                </li>
                <li class="menu-item">
                  <a href="http://www.fiji.org/getinvolved/#Source_Code">Source Code</a>
                </li>
                <li class="menu-item">
                  <a href="http://www.fiji.org/getinvolved/#Issue_Tracker">Issue Tracking</a>
                </li>
                <li class="menu-item">
                  <a href="http://www.fiji.org/getinvolved/#Contributing_to_Fiji">
                    Contributing to Fiji
                  </a>
                </li>
              </ul>
            </li>
            <li class="dropdown active">
              <a href="/">Documentation</a>
              <ul class="dropdown-menu">
                <li class="menu-item">
                  <a href="http://www.fiji.org/getstarted/#Quick_Start_Guide">Quick Start Guide</a>
                </li>
                <li class="menu-item">
                  <a href="/tutorials.html">Tutorials</a>
                </li>
                <li class="menu-item">
                  <a href="/userguides.html">
                    User Guides
                  </a>
                </li>
                <li class="menu-item">
                  <a href="/apidocs">API Reference</a>
                </li>
                <li class="menu-item">
                  <a href="https://github.com/fijiproject/wiki/wiki">Wiki</a>
                </li>
              </ul>
            </li>
            <li>
              <a href="http://www.fiji.org/blog/">Blog</a>
            </li>
            <li>
              <a href="http://www.fiji.org/aboutfiji">About Fiji</a>
            </li>
          </ul>
        </div>
      </div>
    </div>

    <div class="container-fluid">
      <div class="content">
        
<div class="row-fluid">
  <div class="span9">
    <div class="page-header">
      <h1>Pivoters</h1>
    </div>

    <div class="pagination">
      <ul>
    
      
      
    
      

      
        
        
          
            
            
          
        
          
        
          
            
            
          
        
          
        
          
            
            
              <li class="prev">
                <a href="/userguides/mapreduce/1.2.6/reducers" title="Reducers">
                &larr; Previous
                </a>
              </li>
            
          
        
          
        
          
            
            
          
        
          
        
          
            
            
          
        
          
        
          
            
            
          
        
          
        
          
        
          
            
            
          
        
          
            
            
          
        
          
        
          
            
            
          
        
          
        
          
            
            
          
        
          
        
          
        
          
            
            
          
        
          
        
          
            
            
          
        
      

      
      
        
        
          
            
            
          
        
          
        
          
            
            
          
        
          
        
          
            
            
          
        
          
        
          
            
            
          
        
          
        
          
            
            
          
        
          
        
          
            
            
          
        
          
        
          
        
          
            
            
          
        
          
            
            
          
        
          
        
          
            
            
              <li class="next">
                <a href="/userguides/mapreduce/1.2.6/hfiles" title="HFiles">
                Next &rarr;
                </a>
              </li>
            
          
        
          
        
          
            
            
          
        
          
        
          
        
          
            
            
          
        
          
        
          
            
            
          
        
      
      </ul>
    </div>

    <h3>Motivation</h3>

<p>A <a href="http://api-docs.fiji.org/fiji-mapreduce/1.2.6/org/fiji/mapreduce/produce/FijiPivoter.html"><code>FijiPivoter</code></a> scans the rows from an input Fiji
table and writes cells into an output Fiji table.  A pivoter is subject to no restriction regarding
the table, row or column being written to. As the name suggests, a Fiji pivoter's best use-case is
to perform a pivot, eg. generate a reverse look-up table, but are not limited to that. A Fiji
pivoter is a map-only job : if a reduce operation is needed, use a gatherer combined with a reducer.</p>

<h3>Classes Overview</h3>

<p>The main classes around Fiji pivoters are:</p>

<ul>
<li><code>org.fiji.mapreduce.pivot.FijiPivoter</code> is the abstract base class Fiji pivoters must extend.</li>
<li><code>org.fiji.mapreduce.FijiTableContext</code> allows Fiji pivoters to emit cells into the configured
output table while accessing KeyValue stores.</li>
<li><code>org.fiji.mapreduce.pivot.FijiPivotJobBuilder</code> is a programmatic builder and launcher for Fiji
pivoter jobs. Pivoter jobs can also be launched using the command-line tool fiji pivot.</li>
</ul>


<h3>Using the API</h3>

<p>A FijiPivoter must extend the abstract base class FijiPivoter and define the following methods:</p>

<ul>
<li><code>FijiDataRequest getDataRequest()</code> : let the pivoter specify which data to request from the
configured input Fiji table.</li>
<li>void produce(FijiRowData row, FijiTableContext context) : this method is invoked by the FijiMR
framework to process one single input row from the configured input Fiji table. The row content
is available through the row parameter; the pivoter may use the content from this row to emit
cells to write to the configured output Fiji table using the context parameter.</li>
</ul>


<p>As mentioned above, the FijiTableContext let the pivoter task write to the configured output Fiji
table as follows:</p>

<ul>
<li><code>EntityId getEntityId(Object... components)</code> lets the pivoter create entity IDs to identify the
rows of the configured output table to write to.</li>
<li><code>void put(EntityId entityId, String family, String qualifier, [long timestamp], T value)</code> writes
a single cell to the row with the specified entity ID, into the column specified by
family:qualifier. The timestamp parameter is optional; when omitted, the current time
(HConstants.LATEST_TIMESTAMP) is used. The cell value must be compatible with the layout of the
column it is written to.</li>
</ul>


<p>Optionally, a pivoter may implement setup() and cleanup() to initialize and finalize resources that
can be reused across the many invocations of produce():</p>

<ul>
<li><code>setup()</code> is invoked exactly once per task before processing any input row;</li>
<li><code>cleanup()</code> is invoked exactly once per task after it processed all its rows.</li>
</ul>


<p>A pivoter may also request external KeyValueStore by implementing the getRequiredStore() method.
KeyValue store readers are usually opened from the setup() method using context.getStore(storeName).
For more details, you may check the KeyValue Stores section in this guide.</p>

<h3>Example:</h3>

<div class="highlight"><pre><code class="java"><span class="cm">/**</span>
<span class="cm"> * Example of a trivial pivoter.</span>
<span class="cm"> *</span>
<span class="cm"> * Reads an input table keyed on user login names and containing a column &quot;info:email&quot;,</span>
<span class="cm"> * and writes to an output table keyed on email addresses with a column &quot;info:login&quot;.</span>
<span class="cm"> */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">PivoterExample</span> <span class="kd">extends</span> <span class="n">FijiPivoter</span> <span class="o">{</span>
  <span class="cm">/** {@inheritDoc} */</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">FijiDataRequest</span> <span class="nf">getDataRequest</span><span class="o">()</span> <span class="o">{</span>
    <span class="c1">// Request all columns in family &quot;info&quot; from the input Fiji table:</span>
    <span class="k">return</span> <span class="n">FijiDataRequest</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="s">&quot;info&quot;</span><span class="o">);</span>
  <span class="o">}</span>

  <span class="cm">/** {@inheritDoc} */</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">produce</span><span class="o">(</span><span class="n">FijiRowData</span> <span class="n">row</span><span class="o">,</span> <span class="n">FijiTableContext</span> <span class="n">context</span><span class="o">)</span>
      <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="kd">final</span> <span class="n">String</span> <span class="n">login</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="na">getEntityId</span><span class="o">().</span><span class="na">getComponentByIndex</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
    <span class="kd">final</span> <span class="n">String</span> <span class="n">email</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="na">getMostRecentValue</span><span class="o">(</span><span class="s">&quot;info&quot;</span><span class="o">,</span> <span class="s">&quot;email&quot;</span><span class="o">);</span>

    <span class="kd">final</span> <span class="n">EntityId</span> <span class="n">eid</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="na">getEntityId</span><span class="o">(</span><span class="n">email</span><span class="o">);</span>
    <span class="n">context</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">eid</span><span class="o">,</span> <span class="s">&quot;info&quot;</span><span class="o">,</span> <span class="s">&quot;login&quot;</span><span class="o">,</span> <span class="n">login</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div>


<p>The example pivoter can be run from the command-line as follows:</p>

<div class="highlight"><pre><code class="bash">fiji pivot <span class="se">\</span>
    --pivoter<span class="o">=</span><span class="s1">&#39;package.PivoterExample&#39;</span> <span class="se">\</span>
    --input<span class="o">=</span><span class="s2">&quot;format=fiji table=fiji://.env/default/input_table&quot;</span> <span class="se">\</span>
    --output<span class="o">=</span><span class="s2">&quot;format=fiji table=fiji://.env/default/output_table nsplits=5&quot;</span> <span class="se">\</span>
    --lib<span class="o">=</span>/path/to/libdir/
</code></pre></div>


<p>The pivoter command-line argument specifies the fully-qualified name of the FijiPivoter class to
run. The input argument specifies the input Fiji table to read from; the output argument specifies
the output Fiji table to write to. In this example, both the input and the output table belong to
the same Fiji instance fiji://.env/default. Optionally, the lib argument specifies the path of a
directory that contains jar files necessary for the FijiPivoter class.</p>


    <div class="pagination">
      <ul>
    
      
      
    
      

      
        
        
          
            
            
          
        
          
        
          
            
            
          
        
          
        
          
            
            
              <li class="prev">
                <a href="/userguides/mapreduce/1.2.6/reducers" title="Reducers">
                &larr; Previous
                </a>
              </li>
            
          
        
          
        
          
            
            
          
        
          
        
          
            
            
          
        
          
        
          
            
            
          
        
          
        
          
        
          
            
            
          
        
          
            
            
          
        
          
        
          
            
            
          
        
          
        
          
            
            
          
        
          
        
          
        
          
            
            
          
        
          
        
          
            
            
          
        
      

      
      
        
        
          
            
            
          
        
          
        
          
            
            
          
        
          
        
          
            
            
          
        
          
        
          
            
            
          
        
          
        
          
            
            
          
        
          
        
          
            
            
          
        
          
        
          
        
          
            
            
          
        
          
            
            
          
        
          
        
          
            
            
              <li class="next">
                <a href="/userguides/mapreduce/1.2.6/hfiles" title="HFiles">
                Next &rarr;
                </a>
              </li>
            
          
        
          
        
          
            
            
          
        
          
        
          
        
          
            
            
          
        
          
        
          
            
            
          
        
      
      </ul>
    </div>
  </div>

  <div class="span3">
    
      
      
    
    <div class="side-toc">
    <div class="side-toc-inner">
      <h3>FijiMR User Guide</h3>
      <ul>
        
          
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
              
                <li>
                  
                    <a href="/userguides/mapreduce/1.2.6/fiji-mr-overview">What is FijiMR?</a>
                  
                </li>
              
            
          
            
              
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
        
          
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
              
            
          
            
              
                <li>
                  
                    <a href="/userguides/mapreduce/1.2.6/bulk-importers">Bulk Importers</a>
                  
                </li>
              
            
          
        
          
          
            
          
            
          
            
          
            
          
            
          
            
          
            
              
                <li>
                  
                    <a href="/userguides/mapreduce/1.2.6/producers">Producers</a>
                  
                </li>
              
            
          
            
              
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
        
          
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
              
                <li>
                  
                    <a href="/userguides/mapreduce/1.2.6/gatherers">Gatherers</a>
                  
                </li>
              
            
          
            
              
            
          
            
          
            
          
            
          
            
          
        
          
          
            
          
            
          
            
          
            
          
            
              
                <li>
                  
                    <a href="/userguides/mapreduce/1.2.6/reducers">Reducers</a>
                  
                </li>
              
            
          
            
              
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
        
          
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
              
                <li>
                  
                    <b>Pivoters</b>
                  
                </li>
              
            
          
            
              
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
        
          
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
              
                <li>
                  
                    <a href="/userguides/mapreduce/1.2.6/hfiles">HFiles</a>
                  
                </li>
              
            
          
            
              
            
          
            
          
            
          
            
          
            
          
            
          
            
          
        
          
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
              
            
          
            
              
                <li>
                  
                    <a href="/userguides/mapreduce/1.2.6/command-line-tools">Command Line Tools</a>
                  
                </li>
              
            
          
            
          
            
          
        
          
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
              
            
          
            
              
                <li>
                  
                    <a href="/userguides/mapreduce/1.2.6/key-value-stores">Key-Value Stores</a>
                  
                </li>
              
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
        
          
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
              
                <li>
                  
                    <a href="/userguides/mapreduce/1.2.6/job-history">Job History</a>
                  
                </li>
              
            
          
            
              
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
        
          
          
            
              
                <li>
                  
                    <a href="/userguides/mapreduce/1.2.6/working-with-avro">Working with Avro</a>
                  
                </li>
              
            
          
            
              
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
        
          
          
            
          
            
          
            
              
                <li>
                  
                    <a href="/userguides/mapreduce/1.2.6/testing">Testing</a>
                  
                </li>
              
            
          
            
              
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
        
          
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
        
          
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
        
          
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
        
          
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
        
          
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
        
          
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
        
          
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
        
          
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
        
          
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
        
          
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
        
          
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
        
          
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
        
      </ul>
      <h3>Need Help?</h3>
      <ul>
        <li>
      <a class="btn btn-info"  href="https://groups.google.com/a/fiji.org/forum/?fromgroups#!forum/user">User Group Mailing List</a>
        </li>
        <li>
      <a class="btn btn-warning" href="https://jira.fiji.org/secure/CreateIssueDetails!init.jspa?pid=10004&issuetype=1&priority=3&components=10010&summary=Reported%20Docs%20Error:%20Pivoters&description=Please%20describe%20the%20issue.%0a%0aurl:%20/userguides/mapreduce/1.2.6/pivoters"> Report an Error in Docs </a> 
        </li>
    </ul>
    </div>
</div>

  </div>
</div>


      </div>

      <footer>
        <hr/>
        <p>&copy; Fiji Community</p>
      </footer>
    </div>

    


  <script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-35866189-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>



  </body>
</html>

