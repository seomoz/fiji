
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Top Next Songs</title>
    <meta name="description" content="Find the most popular song played after this song.">
    <meta name="author" content="WibiData">
    <link href="/assets/themes/twitter/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="/assets/themes/twitter/css/style.css" rel="stylesheet" type="text/css" media="all">
    <link href="/assets/themes/twitter/css/github.css" rel="stylesheet" type="text/css" media="all">
    <script src="http://code.jquery.com/jquery-latest.js" type="text/javascript"></script>
    <script src="/assets/themes/twitter/vallenato/vallenato.js" type="text/javascript"></script>
    <link rel="stylesheet" href="/assets/themes/twitter/css/vallenato.css" type="text/css" media="screen">
  </head>

  <body>
    <div class="navbar navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container-fluid">
          <a class="brand" href="http://www.fiji.org">Fiji Community</a>
          <ul class="nav">
            <li class="dropdown">
              <a href="http://www.fiji.org">The Fiji Project</a>
              <ul class="dropdown-menu">
                <li class="menu-item">
                  <a href="http://www.fiji.org/features">Features</a>
                </li>
              </ul>
            </li>
            <li>
              <a href="http://www.fiji.org/architecture">Architecture</a>
            </li>
            <li class="dropdown">
              <a href="http://www.fiji.org/getstarted/">Get Started</a>
              <ul class="dropdown-menu">
                <li class="menu-item">
                  <a href="http://www.fiji.org/getstarted/#Downloads">Downloads</a>
                </li>
                <li class="menu-item">
                  <a href="http://www.fiji.org/getstarted/#Installation">Installation</a>
                </li>
                <li class="menu-item">
                  <a href="http://www.fiji.org/getstarted/#Quick_Start_Guide">Quick Start Guide</a>
                </li>
                <li class="menu-item">
                  <a href="http://www.fiji.org/get-started-with-maven">Getting Started with Maven</a>
                </li>
                <li class="menu-item">
                  <a href="http://www.fiji.org/getstarted/#Training_Services">
                    Training & Services
                  </a>
                </li>
              </ul>
            </li>
            <li class="dropdown">
              <a href="http://www.fiji.org/getinvolved">Get Involved</a>
              <ul class="dropdown-menu">
                <li class="menu-item">
                  <a href="http://www.fiji.org/getinvolved/#Mailing_Lists">Mailing Lists</a>
                </li>
                <li class="menu-item">
                  <a href="http://www.fiji.org/getinvolved/#Source_Code">Source Code</a>
                </li>
                <li class="menu-item">
                  <a href="http://www.fiji.org/getinvolved/#Issue_Tracker">Issue Tracking</a>
                </li>
                <li class="menu-item">
                  <a href="http://www.fiji.org/getinvolved/#Contributing_to_Fiji">
                    Contributing to Fiji
                  </a>
                </li>
              </ul>
            </li>
            <li class="dropdown active">
              <a href="/">Documentation</a>
              <ul class="dropdown-menu">
                <li class="menu-item">
                  <a href="http://www.fiji.org/getstarted/#Quick_Start_Guide">Quick Start Guide</a>
                </li>
                <li class="menu-item">
                  <a href="/tutorials.html">Tutorials</a>
                </li>
                <li class="menu-item">
                  <a href="/userguides.html">
                    User Guides
                  </a>
                </li>
                <li class="menu-item">
                  <a href="/apidocs">API Reference</a>
                </li>
                <li class="menu-item">
                  <a href="https://github.com/fijiproject/wiki/wiki">Wiki</a>
                </li>
              </ul>
            </li>
            <li>
              <a href="http://www.fiji.org/blog/">Blog</a>
            </li>
            <li>
              <a href="http://www.fiji.org/aboutfiji">About Fiji</a>
            </li>
          </ul>
        </div>
      </div>
    </div>

    <div class="container-fluid">
      <div class="content">
        
<div class="row-fluid">
  <div class="span9">
    <div class="page-header">
      <h1>Top Next Songs</h1>
    </div>

    <div class="pagination">
      <ul>
    
      
      
    
      

      
        
        
          
        
          
        
          
            
            
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
            
            
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
            
            
              <li class="prev">
                <a href="/tutorials/express-recommendation/0.1.0/express-play-count" title="PlayCount">
                &larr; Previous
                </a>
              </li>
            
          
        
          
            
            
          
        
          
        
          
        
          
        
          
        
          
        
          
            
            
          
        
          
        
          
        
          
        
      

      
      
        
        
          
        
          
        
          
            
            
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
            
            
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
            
            
          
        
          
            
            
          
        
          
        
          
        
          
        
          
        
          
        
          
            
            
          
        
          
        
          
        
          
        
      
      </ul>
    </div>

    <h1 id='top_next_songs'>Top Next Songs</h1>

<p>Now, for each song, we want to compute a list of the songs that are most frequently played by users after that song. This kind of model can eventually be used to write a song recommender.</p>

<p>The entire pipeline for this computation is a little more complex. It looks like this:</p>
<div class='highlight'><pre><code class='scala'><span class='nc'>FijiInput</span><span class='o'>(</span><span class='n'>args</span><span class='o'>(</span><span class='s'>&quot;users-table&quot;</span><span class='o'>))(</span><span class='nc'>Map</span><span class='o'>(</span><span class='nc'>Column</span><span class='o'>(</span><span class='s'>&quot;info:track_plays&quot;</span><span class='o'>,</span> <span class='n'>all</span><span class='o'>)</span> <span class='o'>-&gt;</span> <span class='-Symbol'>&#39;playlist</span><span class='o'>))</span>
    <span class='o'>.</span><span class='n'>flatMap</span><span class='o'>(</span><span class='-Symbol'>&#39;playlist</span> <span class='o'>-&gt;</span> <span class='o'>(</span><span class='-Symbol'>&#39;firstSong</span><span class='o'>,</span> <span class='-Symbol'>&#39;songId</span><span class='o'>))</span> <span class='o'>{</span> <span class='n'>bigrams</span> <span class='o'>}</span>
    <span class='o'>.</span><span class='n'>groupBy</span><span class='o'>((</span><span class='-Symbol'>&#39;firstSong</span><span class='o'>,</span> <span class='-Symbol'>&#39;songId</span><span class='o'>))</span> <span class='o'>{</span> <span class='k'>_</span><span class='o'>.</span><span class='n'>size</span><span class='o'>(</span><span class='-Symbol'>&#39;count</span><span class='o'>)</span> <span class='o'>}</span>
    <span class='o'>.</span><span class='n'>pack</span><span class='o'>[</span><span class='kt'>SongCount</span><span class='o'>]((</span><span class='-Symbol'>&#39;songId</span><span class='o'>,</span> <span class='-Symbol'>&#39;count</span><span class='o'>)</span> <span class='o'>-&gt;</span> <span class='-Symbol'>&#39;songCount</span><span class='o'>)</span>
    <span class='o'>.</span><span class='n'>groupBy</span><span class='o'>(</span><span class='-Symbol'>&#39;firstSong</span><span class='o'>)</span> <span class='o'>{</span> <span class='n'>sortNextSongs</span> <span class='o'>}</span>
    <span class='o'>.</span><span class='n'>map</span><span class='o'>(</span><span class='-Symbol'>&#39;scalaTopSongs</span> <span class='o'>-&gt;</span> <span class='-Symbol'>&#39;topSongs</span><span class='o'>)</span> <span class='o'>{</span> <span class='n'>scalaListToJavaList</span> <span class='o'>}</span>
    <span class='o'>.</span><span class='n'>pack</span><span class='o'>[</span><span class='kt'>TopSongs</span><span class='o'>](</span><span class='-Symbol'>&#39;topSongs</span> <span class='o'>-&gt;</span> <span class='-Symbol'>&#39;topNextSongs</span><span class='o'>)</span>
    <span class='o'>.</span><span class='n'>map</span><span class='o'>(</span><span class='-Symbol'>&#39;firstSong</span> <span class='o'>-&gt;</span> <span class='-Symbol'>&#39;entityId</span><span class='o'>)</span> <span class='o'>{</span> <span class='n'>entityId</span> <span class='o'>}</span>
    <span class='o'>.</span><span class='n'>write</span><span class='o'>(</span><span class='nc'>FijiOutput</span><span class='o'>(</span><span class='n'>args</span><span class='o'>(</span><span class='s'>&quot;songs-table&quot;</span><span class='o'>))(</span><span class='-Symbol'>&#39;topNextSongs</span> <span class='o'>-&gt;</span> <span class='s'>&quot;info:top_next_songs&quot;</span><span class='o'>))</span>
</code></pre></div>
<p>There are some more user-defined functions defined at the top of the file that make this cleaner, but let’s just walk through the pipeline line-by-line and examine those functions as they appear:</p>

<h4 id='read_infotrack_plays_from_a_fiji_table'>Read &#8220;info:track_plays&#8221; from a Fiji table</h4>

<p>The first line reads all values in the “info:track_plays” column from the Fiji table “users-table” into a tuple field called ‘playlist. Recall that the “info:track_plays” column contains, for each user row, each track played by that user, at the timestamp it was played.</p>
<div class='highlight'><pre><code class='scala'>    <span class='nc'>FijiInput</span><span class='o'>(</span><span class='n'>args</span><span class='o'>(</span><span class='s'>&quot;users-table&quot;</span><span class='o'>))(</span><span class='nc'>Map</span><span class='o'>(</span><span class='nc'>Column</span><span class='o'>(</span><span class='s'>&quot;info:track_plays&quot;</span><span class='o'>,</span> <span class='n'>all</span><span class='o'>)</span> <span class='o'>-&gt;</span> <span class='-Symbol'>&#39;playlist</span><span class='o'>))</span>
</code></pre></div>
<h4 id='transform_songs_histories_into_bigrams_of_songs'>Transform songs histories into bigrams of songs</h4>

<p>The next line maps ‘playlist (all songs a user has played) to bigrams of songs that were played in that order. <code>bigrams</code> is our first user-defined function in the pipeline, and it’s an important one.</p>
<div class='highlight'><pre><code class='scala'><span class='cm'>/**</span>
<span class='cm'> * Transforms a slice of song ids into a collection of tuples `(s1,</span>
<span class='cm'> * s2)` signifying that `s2` appeared after `s1` in the slice, chronologically.</span>
<span class='cm'> *</span>
<span class='cm'> * @param slice of song ids representing a user&#39;s play history.</span>
<span class='cm'> * @return a list of song bigrams.</span>
<span class='cm'> */</span>
<span class='k'>def</span> <span class='n'>bigrams</span><span class='o'>(</span><span class='n'>slice</span><span class='k'>:</span> <span class='kt'>FijiSlice</span><span class='o'>[</span><span class='kt'>String</span><span class='o'>])</span><span class='k'>:</span> <span class='kt'>List</span><span class='o'>[(</span><span class='kt'>String</span>, <span class='kt'>String</span><span class='o'>)]</span> <span class='k'>=</span> <span class='o'>{</span>
  <span class='n'>slice</span><span class='o'>.</span><span class='n'>orderChronologically</span><span class='o'>().</span><span class='n'>cells</span><span class='o'>.</span><span class='n'>sliding</span><span class='o'>(</span><span class='mi'>2</span><span class='o'>)</span>
      <span class='o'>.</span><span class='n'>map</span> <span class='o'>{</span> <span class='n'>itr</span> <span class='k'>=&gt;</span> <span class='n'>itr</span><span class='o'>.</span><span class='n'>iterator</span> <span class='o'>}</span>
      <span class='o'>.</span><span class='n'>map</span> <span class='o'>{</span> <span class='n'>itr</span> <span class='k'>=&gt;</span> <span class='o'>(</span><span class='n'>itr</span><span class='o'>.</span><span class='n'>next</span><span class='o'>().</span><span class='n'>datum</span><span class='o'>,</span> <span class='n'>itr</span><span class='o'>.</span><span class='n'>next</span><span class='o'>().</span><span class='n'>datum</span><span class='o'>)</span> <span class='o'>}</span>
      <span class='o'>.</span><span class='n'>toList</span>
<span class='o'>}</span>
</code></pre></div>
<p><code>bigrams</code> takes as an argument a slice of the table, and transforms it into a collection of tuples. Each tuple is a pair of songs where the second song was played directly after the first, that is, the function outputs a sequence of every two adjacent songs in the input. Bigrams are common in many types of statistical analysis, see <a href='http://en.wikipedia.org/wiki/Bigram'>the Wikipedia article on bigrams</a> for more. We use a flatMap since the bigrams method produces a list of song pairs from each playlist.</p>
<div class='highlight'><pre><code class='scala'>    <span class='o'>.</span><span class='n'>flatMap</span><span class='o'>(</span><span class='-Symbol'>&#39;playlist</span> <span class='o'>-&gt;</span> <span class='o'>(</span><span class='-Symbol'>&#39;firstSong</span><span class='o'>,</span> <span class='-Symbol'>&#39;songId</span><span class='o'>))</span> <span class='o'>{</span> <span class='n'>bigrams</span> <span class='o'>}</span>
</code></pre></div>
<h4 id='count_the_occurrences_of_every_unique_song_pair'>Count the occurrences of every unique song pair</h4>

<p>To perform a count, the <code>groupBy</code> method will be used to count the unique occurrences of two songs played in sequence.</p>
<div class='highlight'><pre><code class='scala'>    <span class='o'>.</span><span class='n'>groupBy</span><span class='o'>((</span><span class='-Symbol'>&#39;firstSong</span><span class='o'>,</span> <span class='-Symbol'>&#39;songId</span><span class='o'>))</span> <span class='o'>{</span> <span class='k'>_</span><span class='o'>.</span><span class='n'>size</span><span class='o'>(</span><span class='-Symbol'>&#39;count</span><span class='o'>)</span> <span class='o'>}</span>
</code></pre></div>
<h4 id='pack_the_pair_of_songid_and_count_into_a_songcount_record'>Pack the pair of ‘songId and ‘count into a SongCount record</h4>

<p>Next, a <code>SongCount</code> record is constructed containing the song played and the count associated with it. Scalding&#8217;s <code>pack</code> method is used to perform this operation. <code>pack</code> takes a mapping from tuple fields to a field name to bind the resulting record to. Any fields specified must have matching setters named <code>set&lt;Fieldname&gt;</code>.</p>
<div class='highlight'><pre><code class='scala'>    <span class='o'>.</span><span class='n'>pack</span><span class='o'>[</span><span class='kt'>SongCount</span><span class='o'>]((</span><span class='-Symbol'>&#39;songId</span><span class='o'>,</span> <span class='-Symbol'>&#39;count</span><span class='o'>)</span> <span class='o'>-&gt;</span> <span class='-Symbol'>&#39;songCount</span><span class='o'>)</span>
</code></pre></div>
<h4 id='sort_the_nextsongs_associated_with_each_firstsong'>Sort the ‘nextSongs associated with each ‘firstSong</h4>
<div class='highlight'><pre><code class='scala'>    <span class='o'>.</span><span class='n'>groupBy</span><span class='o'>(</span><span class='-Symbol'>&#39;firstSong</span><span class='o'>)</span> <span class='o'>{</span> <span class='n'>sortNextSongs</span> <span class='o'>}</span>
</code></pre></div>
<p>We’re basically done! ‘nextTopSongs contains the data we want: the next top songs, sorted by popularity, that follow any particular song. The last few lines are the machinery required to put that into our songs table.</p>

<h4 id='do_some_final_processing_on_the_tuples'>Do some final processing on the tuples</h4>

<p>Before we&#8217;re done, we do a simple conversion of Scala Lists to Java Lists and pack that list into the TopSongs record in the ‘topNextSongs field. This uses a straightforward user-defined function that converts Scala Lists to Java Lists:</p>
<div class='highlight'><pre><code class='scala'><span class='cm'>/**</span>
<span class='cm'> * Transforms a Scala `List` into a Java `List`.</span>
<span class='cm'> *</span>
<span class='cm'> * @param ls is the list to transform.</span>
<span class='cm'> * @tparam T is the type of data in the list.</span>
<span class='cm'> * @return a Java `List` created from the original Scala `List`.</span>
<span class='cm'> */</span>
<span class='k'>def</span> <span class='n'>scalaListToJavaList</span><span class='o'>[</span><span class='kt'>T</span><span class='o'>](</span><span class='n'>ls</span><span class='k'>:</span> <span class='kt'>List</span><span class='o'>[</span><span class='kt'>T</span><span class='o'>])</span><span class='k'>:</span> <span class='kt'>java.util.List</span><span class='o'>[</span><span class='kt'>T</span><span class='o'>]</span> <span class='k'>=</span> <span class='nc'>Lists</span><span class='o'>.</span><span class='n'>newArrayList</span><span class='o'>[</span><span class='kt'>T</span><span class='o'>](</span><span class='n'>ls</span><span class='o'>.</span><span class='n'>asJava</span><span class='o'>)</span>
</code></pre></div><div class='highlight'><pre><code class='scala'>    <span class='o'>.</span><span class='n'>map</span><span class='o'>(</span><span class='-Symbol'>&#39;scalaTopSongs</span> <span class='o'>-&gt;</span> <span class='-Symbol'>&#39;topSongs</span><span class='o'>)</span> <span class='o'>{</span> <span class='n'>scalaListToJavaList</span> <span class='o'>}</span>
    <span class='o'>.</span><span class='n'>pack</span><span class='o'>[</span><span class='kt'>TopSongs</span><span class='o'>](</span><span class='-Symbol'>&#39;topSongs</span> <span class='o'>-&gt;</span> <span class='-Symbol'>&#39;topNextSongs</span><span class='o'>)</span>
</code></pre></div>
<h4 id='finally_write_the_topnextsongs_field_to_the_infotop_next_songs_column_in_our_table'>Finally, write the ‘topNextSongs field to the “info:top_next_songs” column in our table</h4>

<p>You&#8217;ve seen this function before. It creates a Fiji entityId for the songs table for a songId.</p>
<div class='highlight'><pre><code class='scala'><span class='cm'>/**</span>
<span class='cm'> * Transforms the identifier for a song into an entity id for the songs table.</span>
<span class='cm'> *</span>
<span class='cm'> * @param songId is an identifier for a song.</span>
<span class='cm'> * @return an entity id for the song in the songs table.</span>
<span class='cm'> */</span>
<span class='k'>def</span> <span class='n'>entityId</span><span class='o'>(</span><span class='n'>songId</span><span class='k'>:</span> <span class='kt'>String</span><span class='o'>)</span><span class='k'>:</span> <span class='kt'>EntityId</span> <span class='o'>=</span> <span class='o'>{</span>
  <span class='k'>val</span> <span class='n'>uri</span> <span class='k'>=</span> <span class='nc'>FijiURI</span><span class='o'>.</span><span class='n'>newBuilder</span><span class='o'>(</span><span class='n'>args</span><span class='o'>(</span><span class='s'>&quot;songs-table&quot;</span><span class='o'>)).</span><span class='n'>build</span><span class='o'>()</span>
  <span class='n'>retainAnd</span><span class='o'>(</span><span class='nc'>Fiji</span><span class='o'>.</span><span class='nc'>Factory</span><span class='o'>.</span><span class='n'>open</span><span class='o'>(</span><span class='n'>uri</span><span class='o'>))</span> <span class='o'>{</span> <span class='n'>fiji</span> <span class='k'>=&gt;</span>
    <span class='n'>retainAnd</span><span class='o'>(</span><span class='n'>fiji</span><span class='o'>.</span><span class='n'>openTable</span><span class='o'>(</span><span class='n'>uri</span><span class='o'>.</span><span class='n'>getTable</span><span class='o'>))</span> <span class='o'>{</span> <span class='n'>table</span> <span class='k'>=&gt;</span>
      <span class='n'>table</span><span class='o'>.</span><span class='n'>getEntityId</span><span class='o'>(</span><span class='n'>songId</span><span class='o'>)</span>
    <span class='o'>}</span>
  <span class='o'>}</span>
<span class='o'>}</span>
</code></pre></div>
<p>We use that function to create the entityId from the first song of the bigram and write out the &#8216;topNextSongs field, which is a TopSongs record, to the <code>info:top_next_songs</code> column:</p>
<div class='highlight'><pre><code class='scala'>    <span class='o'>.</span><span class='n'>map</span><span class='o'>(</span><span class='-Symbol'>&#39;firstSong</span> <span class='o'>-&gt;</span> <span class='-Symbol'>&#39;entityId</span><span class='o'>)</span> <span class='o'>{</span> <span class='n'>entityId</span> <span class='o'>}</span>
    <span class='o'>.</span><span class='n'>write</span><span class='o'>(</span><span class='nc'>FijiOutput</span><span class='o'>(</span><span class='n'>args</span><span class='o'>(</span><span class='s'>&quot;songs-table&quot;</span><span class='o'>))(</span><span class='-Symbol'>&#39;topNextSongs</span> <span class='o'>-&gt;</span> <span class='s'>&quot;info:top_next_songs&quot;</span><span class='o'>))</span>
</code></pre></div>
<h3 id='running_topnextsongs'>Running TopNextSongs</h3>
<div class='userinput'>

<div class='highlight'><pre><code class='bash'>express job <span class='k'>${</span><span class='nv'>MUSIC_EXPRESS_HOME</span><span class='k'>}</span>/lib/fiji-express-music-0.1.0.jar <span class='se'>\</span>
    org.fiji.express.music.TopNextSongs --users-table <span class='k'>${</span><span class='nv'>KIJI</span><span class='k'>}</span>/users <span class='se'>\</span>
    --songs-table <span class='k'>${</span><span class='nv'>KIJI</span><span class='k'>}</span>/songs --hdfs
</code></pre></div>

</div>
<p>Or run it as a script:</p>
<div class='userinput'>

<div class='highlight'><pre><code class='bash'>express script <span class='k'>${</span><span class='nv'>MUSIC_EXPRESS_HOME</span><span class='k'>}</span>/scripts/TopNextSongs.express --hdfs
</code></pre></div>

</div>
<h3 id='verify_the_output'>Verify the Output</h3>
<div class='userinput'>

<div class='highlight'><pre><code class='bash'>fiji scan <span class='k'>${</span><span class='nv'>KIJI</span><span class='k'>}</span>/songs --max-rows<span class='o'>=</span>2
</code></pre></div>

</div>
<p>You should see:</p>

<pre><code>Scanning fiji table: fiji://localhost:2181/fiji_express_music/songs/
entity-id=[&#39;song-32&#39;] [1365549351598] info:metadata
                                 {&quot;song_name&quot;: &quot;song name-32&quot;, &quot;artist_name&quot;: &quot;artist-2&quot;, &quot;album_name&quot;: &quot;album-0&quot;, &quot;genre&quot;: &quot;genre1.0&quot;, &quot;tempo&quot;: 120, &quot;duration&quot;: 180}
entity-id=[&#39;song-32&#39;] [1365550614616] info:top_next_songs
                                 {&quot;topSongs&quot;: [{&quot;song_id&quot;: &quot;song-31&quot;, &quot;count&quot;: 8}, {&quot;song_id&quot;: &quot;song-30&quot;, &quot;count&quot;: 8}, {&quot;song_id&quot;: &quot;song-33&quot;, &quot;count&quot;: 6}, {&quot;song_id&quot;: &quot;song-32&quot;, &quot;count&quot;: 6}, {&quot;song_id&quot;: &quot;song-38&quot;, &quot;count&quot;: 4}, {&quot;song_id&quot;: &quot;song-37&quot;, &quot;count&quot;: 4}, {&quot;song_id&quot;: &quot;song-39&quot;, &quot;count&quot;: 2}, {&quot;song_id&quot;: &quot;song-8&quot;, &quot;count&quot;: 2}, {&quot;song_id&quot;: &quot;song-6&quot;, &quot;count&quot;: 1}, {&quot;song_id&quot;: &quot;song-34&quot;, &quot;count&quot;: 1}, {&quot;song_id&quot;: &quot;song-29&quot;, &quot;count&quot;: 1}, {&quot;song_id&quot;: &quot;song-24&quot;, &quot;count&quot;: 1}, {&quot;song_id&quot;: &quot;song-23&quot;, &quot;count&quot;: 1}, {&quot;song_id&quot;: &quot;song-0&quot;, &quot;count&quot;: 1}]}

entity-id=[&#39;song-49&#39;] [1365549353027] info:metadata
                                 {&quot;song_name&quot;: &quot;song name-49&quot;, &quot;artist_name&quot;: &quot;artist-3&quot;, &quot;album_name&quot;: &quot;album-1&quot;, &quot;genre&quot;: &quot;genre4.0&quot;, &quot;tempo&quot;: 150, &quot;duration&quot;: 180}
entity-id=[&#39;song-49&#39;] [1365550613461] info:top_next_songs
                                 {&quot;topSongs&quot;: [{&quot;song_id&quot;: &quot;song-38&quot;, &quot;count&quot;: 1}, {&quot;song_id&quot;: &quot;song-8&quot;, &quot;count&quot;: 1}, {&quot;song_id&quot;: &quot;song-31&quot;, &quot;count&quot;: 1}, {&quot;song_id&quot;: &quot;song-10&quot;, &quot;count&quot;: 1}, {&quot;song_id&quot;: &quot;song-6&quot;, &quot;count&quot;: 1}]}</code></pre>

<p>Notice that for each of these songs, there is now a info:top_next_songs column that contains a record “topSongs”, the list of top songs played after each of these, in order of popularity. We now have the data necessary for a song recommendation model based on the most popular next songs.</p>

<p>This concludes the tutorial of FijiExpress. If you were using a bento cluster for this tutorial and are done with it, now is a good time shut it down:</p>
<div class='userinput'>

<div class='highlight'><pre><code class='bash'>    bento stop
</code></pre></div>

</div>

    <div class="pagination">
      <ul>
    
      
      
    
      

      
        
        
          
        
          
        
          
            
            
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
            
            
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
            
            
              <li class="prev">
                <a href="/tutorials/express-recommendation/0.1.0/express-play-count" title="PlayCount">
                &larr; Previous
                </a>
              </li>
            
          
        
          
            
            
          
        
          
        
          
        
          
        
          
        
          
        
          
            
            
          
        
          
        
          
        
          
        
      

      
      
        
        
          
        
          
        
          
            
            
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
            
            
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
            
            
          
        
          
            
            
          
        
          
        
          
        
          
        
          
        
          
        
          
            
            
          
        
          
        
          
        
          
        
      
      </ul>
    </div>
  </div>

  <div class="span3">
    
      
      
    
    <div class="side-toc">
    <div class="side-toc-inner">
      <h3>FijiExpress Tutorial</h3>
      <ul>
        
          
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
              
                <li>
                  
                    <a href="/tutorials/express-recommendation/0.1.0/express-overview">Overview</a>
                  
                </li>
              
            
          
            
              
            
          
            
              
            
          
            
              
            
          
            
              
            
          
            
          
            
          
            
          
            
          
            
          
        
          
          
            
          
            
          
            
          
            
          
            
          
            
              
            
          
            
              
            
          
            
              
            
          
            
              
            
          
            
              
                <li>
                  
                    <a href="/tutorials/express-recommendation/0.1.0/express-setup">Setup</a>
                  
                </li>
              
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
        
          
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
              
            
          
            
              
                <li>
                  
                    <a href="/tutorials/express-recommendation/0.1.0/express-importing-data">Importing Data</a>
                  
                </li>
              
            
          
            
              
            
          
            
              
            
          
            
              
            
          
        
          
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
              
            
          
            
              
            
          
            
              
            
          
            
              
            
          
            
              
                <li>
                  
                    <a href="/tutorials/express-recommendation/0.1.0/express-play-count">PlayCount</a>
                  
                </li>
              
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
        
          
          
            
              
            
          
            
              
            
          
            
              
                <li>
                  
                    <b>Top Next Songs</b>
                  
                </li>
              
            
          
            
              
            
          
            
              
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
        
          
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
              
            
          
            
              
            
          
            
              
            
          
            
              
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
        
          
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
        
          
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
        
          
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
        
          
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
        
          
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
        
          
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
        
          
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
        
          
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
        
          
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
        
          
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
        
          
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
        
          
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
        
          
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
        
          
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
        
          
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
        
          
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
        
          
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
        
          
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
        
          
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
        
          
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
        
          
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
        
          
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
        
          
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
        
      </ul>
      <h3>Need Help?</h3>
      <ul>
        <li>
      <a class="btn btn-info"  href="https://groups.google.com/a/fiji.org/forum/?fromgroups#!forum/user">User Group Mailing List</a>
        </li>
        <li>
      <a class="btn btn-warning" href="https://jira.fiji.org/secure/CreateIssueDetails!init.jspa?pid=10004&issuetype=1&priority=3&components=10010&summary=Reported%20Docs%20Error:%20Top Next Songs&description=Please%20describe%20the%20issue.%0a%0aurl:%20/tutorials/express-recommendation/0.1.0/express-top-next-song"> Report an Error in Docs </a> 
        </li>
    </ul>
    </div>
</div>

  </div>
</div>


      </div>

      <footer>
        <hr/>
        <p>&copy; Fiji Community</p>
      </footer>
    </div>

    


  <script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-35866189-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>



  </body>
</html>

