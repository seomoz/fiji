#! /bin/bash

set -e

# Create jars suitable for uploading Fiji to the Maven central repository at
# https://oss.sonatype.org/

# ASSUMPTIONS:
# 1. You have built Fiji.
# 2. You are running this script from the project root directory.
# 3. You have gpg installed and configured

root=$(pwd)

# Then upload jars to maven central
find output/maven_repository/com/moz/fiji -name "*.pom" | while read f
do
  d=$(dirname $f)
  echo "Deploying: $d"
  (
    cd $d
    mvn deploy --settings $root/devtools/settings.xml \
      -DperformRelease=true -DskipTests=true
  )
done
